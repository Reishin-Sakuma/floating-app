# TASK-002: 設定ファイル管理システム - テストケース

## テストケース一覧

### 基本機能テスト

#### TC-001: ConfigManager初期化
- **目的**: ConfigManagerが正常に初期化される
- **前提条件**: なし
- **実行手順**:
  1. ConfigManagerインスタンスを作成
  2. デフォルト設定パスで初期化確認
- **期待結果**: 
  - インスタンスが正常に作成される
  - config_file_pathが設定される

#### TC-002: デフォルト設定取得
- **目的**: デフォルト設定が正しく返される
- **前提条件**: ConfigManagerインスタンスが存在
- **実行手順**:
  1. get_default_config()を呼び出し
- **期待結果**:
  - デフォルト設定辞書が返される
  - 全必須キーが含まれている
  - 値の型が正しい

### 設定ファイル読み込みテスト

#### TC-101: 正常な設定ファイル読み込み
- **目的**: 有効な設定ファイルが正しく読み込まれる
- **前提条件**: 有効なJSON設定ファイルが存在
- **実行手順**:
  1. 有効な設定ファイルを作成
  2. load_config()を呼び出し
- **期待結果**:
  - 設定辞書が正しく返される
  - 全ての値が期待値と一致

#### TC-102: 設定ファイルが存在しない場合
- **目的**: ファイルが存在しない場合にデフォルト設定が返される
- **前提条件**: 設定ファイルが存在しない
- **実行手順**:
  1. 存在しないファイルパスでload_config()を呼び出し
- **期待結果**:
  - デフォルト設定が返される
  - 新しい設定ファイルが作成される

#### TC-103: 破損した設定ファイル読み込み
- **目的**: JSONパースエラー時の自動復旧
- **前提条件**: 無効なJSON形式のファイルが存在
- **実行手順**:
  1. 無効なJSONファイルを作成
  2. load_config()を呼び出し
- **期待結果**:
  - バックアップから復旧を試行
  - 復旧できない場合はデフォルト設定を返す
  - エラーログが記録される

### 設定ファイル保存テスト

#### TC-201: 正常な設定保存
- **目的**: 有効な設定が正しく保存される
- **前提条件**: 有効な設定辞書が用意されている
- **実行手順**:
  1. 有効な設定辞書を作成
  2. save_config()を呼び出し
  3. ファイルが作成されることを確認
- **期待結果**:
  - Trueが返される
  - 設定ファイルが正しく作成される
  - JSON形式が正しい

#### TC-202: 書き込み権限エラー
- **目的**: 書き込み権限がない場合のエラーハンドリング
- **前提条件**: 書き込み権限のないディレクトリ
- **実行手順**:
  1. 読み取り専用ディレクトリに設定ファイルパスを設定
  2. save_config()を呼び出し
- **期待結果**:
  - Falseが返される
  - 適切なエラーメッセージがログに記録される

### バリデーションテスト

#### TC-301: 有効な設定値のバリデーション
- **目的**: 正しい設定値がバリデーションをパスする
- **前提条件**: 有効な設定辞書が用意されている
- **実行手順**:
  1. 有効な設定値でvalidate_config()を呼び出し
- **期待結果**:
  - (True, [])が返される

#### TC-302: 無効なapp_pathのバリデーション
- **目的**: 無効なアプリケーションパスが検知される
- **前提条件**: 存在しないファイルパスを含む設定
- **実行手順**:
  1. 存在しないファイルパスを設定
  2. validate_config()を呼び出し
- **期待結果**:
  - (False, [エラーメッセージ])が返される
  - ファイル存在エラーが含まれる

#### TC-303: 無効なicon_positionのバリデーション
- **目的**: 範囲外のアイコン位置が検知される
- **前提条件**: 範囲外の座標値を含む設定
- **実行手順**:
  1. x座標に50000を設定
  2. validate_config()を呼び出し
- **期待結果**:
  - (False, [エラーメッセージ])が返される
  - 座標範囲エラーが含まれる

#### TC-304: 無効なicon_sizeのバリデーション
- **目的**: 範囲外のアイコンサイズが検知される
- **前提条件**: 範囲外のサイズ値を含む設定
- **実行手順**:
  1. icon_sizeに200を設定
  2. validate_config()を呼び出し
- **期待結果**:
  - (False, [エラーメッセージ])が返される
  - サイズ範囲エラーが含まれる

### バックアップ・復旧テスト

#### TC-401: 設定バックアップ作成
- **目的**: 設定ファイルのバックアップが正しく作成される
- **前提条件**: 有効な設定ファイルが存在
- **実行手順**:
  1. backup_config()を呼び出し
- **期待結果**:
  - バックアップファイルパスが返される
  - バックアップファイルが実際に作成される
  - 内容が元ファイルと一致する

#### TC-402: バックアップからの復旧
- **目的**: バックアップから設定が正しく復旧される
- **前提条件**: 有効なバックアップファイルが存在
- **実行手順**:
  1. 元の設定ファイルを破損させる
  2. restore_from_backup()を呼び出し
- **期待結果**:
  - Trueが返される
  - 設定ファイルがバックアップ内容で復旧される

#### TC-403: 存在しないバックアップからの復旧
- **目的**: 存在しないバックアップファイル指定時のエラーハンドリング
- **前提条件**: 存在しないバックアップファイルパス
- **実行手順**:
  1. 存在しないパスでrestore_from_backup()を呼び出し
- **期待結果**:
  - Falseが返される
  - エラーメッセージがログに記録される

### デフォルトリセットテスト

#### TC-501: デフォルトリセット
- **目的**: 設定がデフォルト値にリセットされる
- **前提条件**: カスタム設定ファイルが存在
- **実行手順**:
  1. reset_to_default()を呼び出し
  2. load_config()で設定を確認
- **期待結果**:
  - Trueが返される
  - 全設定がデフォルト値になる

### エラーケーステスト

#### TC-601: ディスク容量不足エラー
- **目的**: ディスク容量不足時の適切なエラーハンドリング
- **前提条件**: ディスク容量不足状況をシミュレート
- **実行手順**:
  1. 大量のデータを含む設定でsave_config()を呼び出し
- **期待結果**:
  - Falseが返される
  - ディスク容量エラーがログに記録される

#### TC-602: 同時アクセステスト
- **目的**: 複数プロセスからの同時アクセス処理
- **前提条件**: 複数のConfigManagerインスタンス
- **実行手順**:
  1. 同時に複数のインスタンスから設定を保存
- **期待結果**:
  - データ競合が発生しない
  - 最後の保存が有効になる

### パフォーマンステスト

#### TC-701: 読み込み速度テスト
- **目的**: 設定読み込みが100ms以内に完了する
- **前提条件**: 標準的なサイズの設定ファイル
- **実行手順**:
  1. 時間測定しながらload_config()を呼び出し
- **期待結果**:
  - 100ms以内に完了する

#### TC-702: 保存速度テスト
- **目的**: 設定保存が500ms以内に完了する
- **前提条件**: 標準的なサイズの設定データ
- **実行手順**:
  1. 時間測定しながらsave_config()を呼び出し
- **期待結果**:
  - 500ms以内に完了する

### セキュリティテスト

#### TC-801: ファイル改ざん検知
- **目的**: 設定ファイルの改ざんが検知される
- **前提条件**: 有効な設定ファイルが存在
- **実行手順**:
  1. 設定ファイルを外部から改ざん
  2. load_config()を呼び出し
- **期待結果**:
  - 改ざんが検知される
  - バックアップからの復旧が試行される

## テスト実行順序

1. **基本機能テスト** (TC-001, TC-002)
2. **読み込みテスト** (TC-101～TC-103)
3. **バリデーションテスト** (TC-301～TC-304)
4. **保存テスト** (TC-201～TC-202)
5. **バックアップ・復旧テスト** (TC-401～TC-403)
6. **デフォルトリセットテスト** (TC-501)
7. **エラーケーステスト** (TC-601～TC-602)
8. **パフォーマンステスト** (TC-701～TC-702)
9. **セキュリティテスト** (TC-801)

## テスト環境要件

- Python 3.8以降
- pytest テストフレームワーク
- 一時ディレクトリの作成・削除権限
- ファイルシステムアクセス権限