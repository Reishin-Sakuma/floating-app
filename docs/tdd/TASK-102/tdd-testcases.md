# TASK-102: フローティングアイコン描画エンジン - テストケース

## テストケース一覧

### 基本機能テスト

#### TC-001: FloatingIcon初期化
- **目的**: FloatingIconが正常に初期化される
- **前提条件**: ConfigManagerが利用可能
- **実行手順**:
  1. ConfigManagerインスタンスを作成
  2. FloatingIconインスタンスを作成
- **期待結果**: 
  - インスタンスが正常に作成される
  - 内部状態が適切に初期化される
  - tkinter Toplevelが作成される

#### TC-002: アイコン表示
- **目的**: フローティングアイコンが正常に表示される
- **前提条件**: FloatingIconインスタンスが作成済み
- **実行手順**:
  1. show()メソッドを呼び出し
- **期待結果**:
  - Trueが返される
  - ウィンドウが画面に表示される
  - is_visible()がTrueを返す

#### TC-003: アイコン非表示
- **目的**: フローティングアイコンが正常に非表示になる
- **前提条件**: FloatingIconが表示状態
- **実行手順**:
  1. hide()メソッドを呼び出し
- **期待結果**:
  - Trueが返される
  - ウィンドウが画面から消える
  - is_visible()がFalseを返す

### 位置管理テスト

#### TC-101: 位置設定
- **目的**: アイコンの位置が正しく設定される
- **前提条件**: FloatingIconが初期化済み
- **実行手順**:
  1. update_position(200, 150)を呼び出し
- **期待結果**:
  - Trueが返される
  - get_position()が(200, 150)を返す
  - ウィンドウが指定位置に移動

#### TC-102: 無効な位置設定
- **目的**: 画面外など無効な位置が適切に処理される
- **前提条件**: FloatingIconが初期化済み
- **実行手順**:
  1. update_position(-100, -100)を呼び出し
- **期待結果**:
  - 位置が画面内に補正される
  - エラーが発生しない
  - 適切な位置に配置される

#### TC-103: 現在位置取得
- **目的**: 現在の位置が正しく取得される
- **前提条件**: FloatingIconが位置設定済み
- **実行手順**:
  1. get_position()を呼び出し
- **期待結果**:
  - (x, y)タプルが返される
  - 設定した位置と一致する

### サイズ管理テスト

#### TC-201: サイズ設定
- **目的**: アイコンのサイズが正しく設定される
- **前提条件**: FloatingIconが初期化済み
- **実行手順**:
  1. update_size(48)を呼び出し
- **期待結果**:
  - Trueが返される
  - get_size()が48を返す
  - ウィンドウサイズが変更される

#### TC-202: 無効なサイズ設定
- **目的**: 無効なサイズ値が適切に処理される
- **前提条件**: FloatingIconが初期化済み
- **実行手順**:
  1. update_size(-10)を呼び出し
- **期待結果**:
  - Falseが返される または 適切なデフォルト値に設定
  - エラーが発生しない

#### TC-203: 現在サイズ取得
- **目的**: 現在のサイズが正しく取得される
- **前提条件**: FloatingIconがサイズ設定済み
- **実行手順**:
  1. get_size()を呼び出し
- **期待結果**:
  - 整数値が返される
  - 設定したサイズと一致する

### イベント処理テスト

#### TC-301: クリックコールバック設定
- **目的**: クリックコールバックが正しく設定される
- **前提条件**: FloatingIconが初期化済み
- **実行手順**:
  1. テスト用コールバック関数を定義
  2. set_click_callback()でコールバックを設定
- **期待結果**:
  - エラーが発生しない
  - コールバックが内部に保存される

#### TC-302: 左クリックイベント処理
- **目的**: 左クリック時にコールバックが呼ばれる
- **前提条件**: クリックコールバックが設定済み
- **実行手順**:
  1. アイコンを表示
  2. 左クリックイベントをシミュレート
- **期待結果**:
  - コールバック関数が呼び出される
  - 適切な引数でコールバックが実行される

#### TC-303: 右クリックコールバック設定
- **目的**: 右クリックコールバックが正しく設定される
- **前提条件**: FloatingIconが初期化済み
- **実行手順**:
  1. テスト用コールバック関数を定義
  2. set_right_click_callback()でコールバックを設定
- **期待結果**:
  - エラーが発生しない
  - コールバックが内部に保存される

#### TC-304: 右クリックイベント処理
- **目的**: 右クリック時にコールバックが呼ばれる
- **前提条件**: 右クリックコールバックが設定済み
- **実行手順**:
  1. アイコンを表示
  2. 右クリックイベントをシミュレート
- **期待結果**:
  - コールバック関数が呼び出される
  - 適切な引数でコールバックが実行される

### 描画・表示テスト

#### TC-401: 基本描画
- **目的**: アイコンが正しく描画される
- **前提条件**: FloatingIconが表示状態
- **実行手順**:
  1. refresh()メソッドを呼び出し
- **期待結果**:
  - 再描画が実行される
  - エラーが発生しない
  - 視覚的に正しく表示される

#### TC-402: 前面表示維持
- **目的**: 他ウィンドウより前面に表示される
- **前提条件**: FloatingIconが表示状態
- **実行手順**:
  1. 他のアプリケーションをアクティブにする
  2. FloatingIconの表示状態を確認
- **期待結果**:
  - アイコンが他ウィンドウより前面に表示される
  - topmost属性が有効になっている

#### TC-403: 透明背景
- **目的**: 背景が透明で表示される
- **前提条件**: FloatingIconが表示状態
- **実行手順**:
  1. 透明背景設定で表示
- **期待結果**:
  - 背景が透明になる
  - アイコン部分のみが可視

### 高DPI対応テスト

#### TC-501: DPIスケーリング検出
- **目的**: システムのDPIスケーリング設定が正しく検出される
- **前提条件**: 異なるDPI環境
- **実行手順**:
  1. DisplayInfo取得機能を実行
- **期待結果**:
  - 正しいDPIスケーリング値が取得される
  - 物理ピクセルと論理ピクセルの変換が正確

#### TC-502: 高DPI環境での表示
- **目的**: 高DPI環境で正常にスケールされる
- **前提条件**: 高DPI環境（125%, 150%, 200%等）
- **実行手順**:
  1. 高DPI環境でFloatingIconを表示
- **期待結果**:
  - アイコンが適切なサイズで表示される
  - ぼやけや歪みがない

#### TC-503: DPI変更時の動的調整
- **目的**: DPI設定変更時に動的に調整される
- **前提条件**: FloatingIconが表示状態
- **実行手順**:
  1. システムDPI設定を変更
  2. アイコンの表示を確認
- **期待結果**:
  - 新しいDPI設定に適応する
  - サイズが自動調整される

### マルチモニター対応テスト

#### TC-601: マルチモニター検出
- **目的**: 複数モニターが正しく検出される
- **前提条件**: マルチモニター環境
- **実行手順**:
  1. ディスプレイ情報取得機能を実行
- **期待結果**:
  - 全モニターが検出される
  - 各モニターの詳細情報が正確

#### TC-602: 異なるモニター間での表示
- **目的**: 複数モニター間でアイコンが正しく表示される
- **前提条件**: マルチモニター環境
- **実行手順**:
  1. セカンダリモニターにアイコンを配置
- **期待結果**:
  - 指定したモニターに正しく表示される
  - 座標計算が正確

#### TC-603: モニター設定変更時の処理
- **目的**: モニター設定変更時に適切に対応する
- **前提条件**: マルチモニター環境
- **実行手順**:
  1. モニター設定を変更（解像度、配置等）
- **期待結果**:
  - アイコンが画面外に表示されない
  - 適切な位置に自動移動

### パフォーマンステスト

#### TC-701: 描画フレームレート
- **目的**: 60FPS以上の描画性能を達成する
- **前提条件**: FloatingIconが表示状態
- **実行手順**:
  1. 描画更新を連続実行
  2. フレームレートを測定
- **期待結果**:
  - 60FPS以上を維持
  - CPU使用率が適切な範囲内

#### TC-702: メモリ使用量
- **目的**: メモリ使用量が要件内に収まる
- **前提条件**: FloatingIconが動作中
- **実行手順**:
  1. 長時間動作させる
  2. メモリ使用量を監視
- **期待結果**:
  - 10MB以下のメモリ使用量
  - メモリリークが発生しない

#### TC-703: CPU使用率
- **目的**: CPU使用率が適切な範囲内
- **前提条件**: FloatingIconが動作中
- **実行手順**:
  1. 通常状態での動作
  2. CPU使用率を測定
- **期待結果**:
  - 通常時1%以下のCPU使用率
  - 描画更新時も適切な範囲内

### 統合テスト

#### TC-801: ConfigManager連携
- **目的**: 設定の保存・読込が正常に動作する
- **前提条件**: ConfigManagerとFloatingIcon両方が利用可能
- **実行手順**:
  1. 位置・サイズを変更
  2. 設定を保存
  3. 再起動後に設定を読込
- **期待結果**:
  - 変更した設定が正しく保存される
  - 再起動後に設定が復元される

#### TC-802: AppLauncher連携
- **目的**: クリック時のアプリケーション起動が正常動作
- **前提条件**: AppLauncherとFloatingIcon両方が利用可能
- **実行手順**:
  1. アプリケーション起動コールバックを設定
  2. アイコンをクリック
- **期待結果**:
  - AppLauncherが呼び出される
  - アプリケーションが正常に起動

### エラーハンドリングテスト

#### TC-901: 描画エラー処理
- **目的**: 描画エラーが適切に処理される
- **前提条件**: 描画エラーが発生する状況
- **実行手順**:
  1. 描画エラーを意図的に発生させる
- **期待結果**:
  - アプリケーションがクラッシュしない
  - 適切なエラー処理が行われる

#### TC-902: ウィンドウシステムエラー
- **目的**: ウィンドウ関連エラーが適切に処理される
- **前提条件**: ウィンドウシステムエラーが発生する状況
- **実行手順**:
  1. ウィンドウエラーを発生させる
- **期待結果**:
  - 適切なフォールバック処理
  - システムの安定性維持

#### TC-903: 設定エラー処理
- **目的**: 無効な設定値が適切に処理される
- **前提条件**: ConfigManagerに無効な設定
- **実行手順**:
  1. 無効な設定値でFloatingIconを初期化
- **期待結果**:
  - デフォルト値で動作
  - エラーが適切に処理される

### アクセシビリティテスト

#### TC-1001: ハイコントラストモード
- **目的**: ハイコントラストモードで正常表示される
- **前提条件**: Windowsハイコントラストモード
- **実行手順**:
  1. ハイコントラストモードを有効にする
  2. FloatingIconを表示
- **期待結果**:
  - 適切なコントラストで表示される
  - 視認性が維持される

#### TC-1002: カラーブラインド対応
- **目的**: 色覚多様性に配慮した表示
- **前提条件**: 色覚シミュレーション環境
- **実行手順**:
  1. 異なる色覚条件でアイコンを確認
- **期待結果**:
  - 色以外の要素でも識別可能
  - 十分なコントラスト確保

## テスト実行順序

1. **基本機能テスト** (TC-001～TC-003)
2. **位置管理テスト** (TC-101～TC-103)
3. **サイズ管理テスト** (TC-201～TC-203)
4. **イベント処理テスト** (TC-301～TC-304)
5. **描画・表示テスト** (TC-401～TC-403)
6. **高DPI対応テスト** (TC-501～TC-503)
7. **マルチモニター対応テスト** (TC-601～TC-603)
8. **パフォーマンステスト** (TC-701～TC-703)
9. **統合テスト** (TC-801～TC-802)
10. **エラーハンドリングテスト** (TC-901～TC-903)
11. **アクセシビリティテスト** (TC-1001～TC-1002)

## テスト環境要件

### ハードウェア要件
- Windows 10/11 PC
- マルチモニター環境（可能であれば）
- 異なるDPI設定対応ディスプレイ
- 十分なメモリ・CPU リソース

### ソフトウェア要件
- Python 3.8以降 + tkinter
- pytest テストフレームワーク
- パフォーマンス測定ツール
- DPI設定変更権限

### テスト用モック・スタブ
- マウスイベントシミュレーター
- ディスプレイ情報モック
- パフォーマンス測定モック
- 設定ファイルモック

## GUI テスト特有の考慮事項

### 視覚確認要件
- 実際の画面表示確認
- スクリーンショット比較
- 色・サイズの正確性確認
- アニメーション動作確認

### 自動化制限
- 一部テストは手動確認必要
- 環境依存テストの扱い
- 視覚的品質の主観評価
- ユーザビリティテストとの連携

## 合計テストケース数: 25個

### カテゴリ別内訳
- 基本機能: 3ケース
- 位置管理: 3ケース  
- サイズ管理: 3ケース
- イベント処理: 4ケース
- 描画・表示: 3ケース
- 高DPI対応: 3ケース
- マルチモニター: 3ケース
- パフォーマンス: 3ケース
- 統合: 2ケース
- エラーハンドリング: 3ケース
- アクセシビリティ: 2ケース